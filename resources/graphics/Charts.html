
<html>
<head>

<style type="text/css">
	body
	{
		background: #f2f2f2;
		padding: 0px;
		margin: 0px;
	}
	
	.table_div
	{
		padding-left: 10px;
		padding-right: 10px;
		width: 98%;
	}
		
	.chart-container
	{
		position: relative;
		margin: auto;
		height: 90vh;
		width: 90vw;
		display: none;
	}
	
	.Alumnos{
		height: 45%;
		color: black;
	}
	
	.Calificaciones{
		height: 45%;
		color: black;
	}
	
	.GenerarGrafico{
		position: fixed;
		bottom: 5px;
		color: black;
	}
	
	.controles{
		position: relative;
		padding-top: 5px;
		padding-left: 5px;
		width: 99%;
	}
	
	.opciones {
		display: inline;
		padding-left: 5px;
	}
		
	.opciones .btn {
		background-color: #066db3;
		border: none;
		color: white;
		font-size: 12px;
		font-weight: bold;
		border-radius: 4px;
		cursor: pointer;
		padding-top: 5px;
		padding-bottom: 5px;
	}
	
	.opciones .btn:hover {
		background-color: #0790ed;
	}
		
	.pestañas {
		position: relative;
		display: inline;
	}
	
	.pestañas .btn {
		background-color: #066db3;
		border: none;
		color: white;
		font-size: 12px;
		font-weight: bold;
		border-radius: 4px 4px 0 0;
		cursor: pointer;
		padding-top: 5px;
		padding-bottom: 5px;
		margin-left: -2px;
	}

	.pestañas .btn:hover {
		 background-color:  #0790ed;
		 font-size: 15px;
	}

	input[type="button"][disabled]{
		font-size: 15px;
	}

	
</style>
		
<script type="text/javascript" src="Chart.js"></script>
<script type="text/javascript" src="color-hash.js"></script>
<script type="text/javascript" src="googleCharts.js"></script>
<script type="text/javascript" src="jquery-3.2.1.js"></script>


</head>

<body>

<div class="controles">
<div class="pestañas">
	<input type="button" value="Lineas" class="btn" id="btnLineas" onclick="generateChart('line')"></input>
	<input type="button" value="Radar" class="btn" id="btnRadar" onclick="generateChart('radar')"></input>
	<input type="button" value="BoxPlot General" class="btn" id="btnBoxPlot" onclick="generateChart('boxplot')"></input>
	<input type="button" value="BoxPlot Del Grupo" class="btn" id="btnBoxPlotGroup" onclick="generateChart('boxplotgroup')"></input>
	<input type="button" value="Calificaciones" class="btn" id="btnCalificaciones" onclick="drawTable()"></input>
</div>

<div class="opciones">
	<input type="button" value="Ocultar Leyenda" class="btn" id="btnLegend" onclick="hideLegend()"></input>
	<input type="button" value="Mostrar Media General" class="btn" id="btnMean" onclick="showGeneralMean()"></input>
	<input type="button" value="Mostrar Media Del Grupo" class="btn" id="btnGroupMean" onclick="showGroupMean()"></input>
</div>
</div>

<div id="inicio">
	<div class="Alumnos">1- SELECCIONA LOS ALUMNOSS</div>
	<div class="Calificaciones">2- SELECCIONA LAS CALIFICACIONES</div>
	<div class="GenerarGrafico">3- GENERA EL GRÁFICO</div>
</div>

<div id="chart-container" class="chart-container">
	<canvas id="myChart"></canvas>
</div>

<div id="table_div" class="table_div"></div>

<script>

//------------------------------------------Opciones para los graficos------------------------------------------------------------------

// Opciones para el gráfico de lineas y el boxplot
var optionsLineChart = {
	maintainAspectRatio: false,
	responsive: true,
	responsiveAnimationDuration: 0, // animation duration after a resize, better perfomance at 0
	showLines: true,
	spanGaps: false, //si se quiere mostrar las lineas cuando en algun elemento no hay dato (NaN)
	animation:{
		 duration: 0 // better performance at 0
	}, //animation
	layout: {
		padding: {
			top: 20,
		} //pading
	}, //layout
	elements: {
		point : {
			pointStyle: 'circle',
			radius: 5,
			hoverRadius: 7
		}, //points
		line: {
			tension: 0.4 //disable bezier curves, better performance
		}
	}, //elements
	legend: {
		display: true,
		position: 'bottom',
		labels : {
			padding: 20,
			usePointStyle: true,
			fontSize: 12,
			fontColor: 'rgba(0, 0, 0, 1)',
			fontFamily: 'sans-serif'
		} //labels
	}, //legend
	tooltips: {
		mode: 'index',
		intersect: false,
		position: 'average',
		backgroundColor: 'rgba(0, 0, 0, 0.8)',
		bodySpacing: 4,
		cornerRadius: 0,
		caretSize: 10,
		itemSort: function(a, b) {return (parseFloat(a.y) - parseFloat(b.y));}	
	}, //tooltips
    scales: {
        yAxes: [
        	{
        		id:'left-y-axis',
        		type: 'linear',
        		position: 'left',
        		gridLines: {
            		display: true,
            		color: 'rgba(0, 0, 0, 0.4)'
            	}, //gridLines
                ticks: 
                {
                    beginAtZero:true,
                    max: 10,
                    stepSize: 1,
                    fontColor: 'rgba(0, 0, 0, 1)'
                }//ticks
        	},
        	{
        		id: 'right-y-axis',
        		type: 'linear',
        		position: 'right',
        		gridLines: {
            		display: true,
            		color: 'rgba(0, 0, 0, 0.4)'
            	}, //gridLines
                ticks: 
                {
                    beginAtZero:true,
                    max: 10,
                    stepSize: 1,
                    fontColor: 'rgba(0, 0, 0, 1)'
                }//ticks
        	}], //yAxes
        xAxes :[{
        	gridLines: {
        		display: true,
        		color: 'rgba(0, 0, 0, 0.4)'
        	}, //gridLines
        	ticks: {
        		autoSkip: false,
        		fontColor: 'rgba(0, 0, 0, 1)'
        	}
        }]//xAxes
    } //scales
} //options
	
// Opciones para el radar
var optionsRadarChart = {
	maintainAspectRatio: false,
	responsive: true,
	responsiveAnimationDuration: 0, // animation duration after a resize, better perfomance at 0
	showLines: true,
	spanGaps: false, //si se quiere mostrar las lineas cuando en algun elemento no hay dato (NaN)
	animation:{
		 duration: 0 // better performance at 0
	}, //animation
	layout: {
		padding: {
			top: 20,
		} //pading
	}, //layout
	elements: {
		point : {
			pointStyle: 'circle',
			radius: 5,
			hoverRadius: 7
		}, //points
		line: {
			tension: 0 //disable bezier curves, better performance
		}
	}, //elements
	legend: {
		display: true,
		position: 'bottom',
		labels : {
			padding: 20,
			usePointStyle: true,
			fontSize: 12,
			fontColor: 'rgba(0, 0, 0, 1)',
			fontFamily: 'sans-serif'
		} //labels
	}, //legend
	tooltips: {
		mode: 'index',
		intersect: true,
		position: 'average',
		backgroundColor: 'rgba(0, 0, 0, 0.8)',
		bodySpacing: 4,
		cornerRadius: 0,
		caretSize: 10,
		itemSort: function(a, b) {return (parseFloat(a.y) - parseFloat(b.y));}	
	}, //tooltips
    scale: {
		gridLines: {
    		display: true,
    		color: 'rgba(0, 0, 0, 0.4)'
    	}, //gridLines
        ticks: 
        {
            beginAtZero:true,
            max: 10,
            stepSize: 1,
            fontColor: 'rgba(0, 0, 0, 1)'
        }//ticks
    } //scales
} //options

//------------------------------------------Variables globales-------------------------------------------------------------

// DataSets
var GeneralMeanDataSet = '';
var GroupMeanDataSet = '';
var LineDataSet = '';
var RadarDataSet = '';
var BoxPlotGeneralDataSet = '';
var BoxPlotGroupDataSet = '';
var TableDataSet = '';

//
var GeneralMeanActive = false;
var GroupMeanActive = false;
var legendActive = true;
var currentType = 'line';

//
var colorHash = new ColorHash();
var ctx = document.getElementById('myChart');

var myChart = new Chart(ctx,{
	type: 'line',
	data:LineDataSet,
	options: optionsLineChart
});

// Cargamos la librearia de google para la tabla de calificaciones
google.charts.load('current', {'packages':['table']});

// Al iniciar el boton del gráfico de lineas esta deshabilitado
document.getElementById('btnLineas').disabled = true;
//Al iniciar el div de la tabla de calificaciones esta oculto
document.getElementById('table_div').style.display = 'none';


//------------------------------------------Funciones------------------------------------------------------------------

// Funcion que crea la tabla de calificaciones
function drawTable() {
	currentType = 'table';
	if(GeneralMeanActive){showGeneralMean();}
	if(GroupMeanActive){showGroupMean();}
	document.getElementById('btnLineas').disabled = false;
	document.getElementById('btnRadar').disabled = false;
	document.getElementById('btnBoxPlot').disabled = false;
	document.getElementById('btnBoxPlotGroup').disabled = false;
	document.getElementById('btnCalificaciones').disabled = true;
	document.getElementById('chart-container').style.display = 'none';
	document.getElementById('table_div').style.display = 'block';
	document.getElementById('btnMean').style.display = 'none';
	document.getElementById('btnGroupMean').style.display = 'none';
	document.getElementById('btnLegend').style.display = 'none';
	
	var data = google.visualization.arrayToDataTable(TableDataSet, false); // 'false' indica que la primera fila son labels, no datos.
    var table = new google.visualization.Table(document.getElementById('table_div'));
    table.draw(data, {showRowNumber: false, allowHTML: true, width: '100%'});
 }

// Funcion que genera y muestra el grafico segun el tipo que se le pase.
function generateChart(type){

	document.getElementById('table_div').style.display = 'none';
	document.getElementById('chart-container').style.display = 'block';
	document.getElementById('inicio').style.display = 'none';
	document.getElementById('btnLegend').style.display = 'inline';
	
	switch (type) {
		case 'line':
			currentType = 'line';
			document.getElementById('btnLineas').disabled = true;
			document.getElementById('btnRadar').disabled = false;
			document.getElementById('btnBoxPlot').disabled = false;
			document.getElementById('btnBoxPlotGroup').disabled = false;
			document.getElementById('btnCalificaciones').disabled = false;
			document.getElementById('btnMean').style.display = 'inline';
			document.getElementById('btnGroupMean').style.display = 'inline';
			if(GeneralMeanActive){showGeneralMean();}
			if(GroupMeanActive){showGroupMean();}
			myChart.destroy();
			myChart = new Chart(ctx,{
				type: 'line',
				data: LineDataSet,
				options: optionsLineChart
			});
			myChart.data.datasets.forEach((dataset) => {
				color = colorRGB(dataset.label);
				dataset.backgroundColor = color + '1)';
				dataset.borderColor = color + '1)';
				dataset.pointBackgroundColor = color + '1)';
				dataset.pointBorderColor = color + '1)';
				dataset.fill = false;
			});
			break;
		case 'boxplot':
			currentType = 'boxplot';
			document.getElementById('btnLineas').disabled = false;
			document.getElementById('btnRadar').disabled = false;
			document.getElementById('btnBoxPlot').disabled = true;
			document.getElementById('btnBoxPlotGroup').disabled = false;
			document.getElementById('btnCalificaciones').disabled = false;
			document.getElementById('btnMean').style.display = 'none';
			document.getElementById('btnGroupMean').style.display = 'none';
			if(GeneralMeanActive){showGeneralMean();}
			if(GroupMeanActive){showGroupMean();}
			myChart.destroy();
			myChart = new Chart(ctx,{
				type: 'line',
				data: BoxPlotGeneralDataSet,
				options: optionsLineChart
			});
			break;
		case 'boxplotgroup':
			currentType = 'boxplotgroup';
			document.getElementById('btnLineas').disabled = false;
			document.getElementById('btnRadar').disabled = false;
			document.getElementById('btnBoxPlot').disabled = false;
			document.getElementById('btnBoxPlotGroup').disabled = true;
			document.getElementById('btnCalificaciones').disabled = false;
			document.getElementById('btnMean').style.display = 'none';
			document.getElementById('btnGroupMean').style.display = 'none';
			if(GeneralMeanActive){showGeneralMean();}
			if(GroupMeanActive){showGroupMean();}
			myChart.destroy();
			myChart = new Chart(ctx,{
				type: 'line',
				data: BoxPlotGroupDataSet,
				options: optionsLineChart
			});
			break;
		case 'radar':
			currentType = 'radar';
			document.getElementById('btnLineas').disabled = false;
			document.getElementById('btnRadar').disabled = true;
			document.getElementById('btnBoxPlot').disabled = false;
			document.getElementById('btnBoxPlotGroup').disabled = false;
			document.getElementById('btnCalificaciones').disabled = false;
			document.getElementById('btnMean').style.display = 'inline';
			document.getElementById('btnGroupMean').style.display = 'inline';
			if(GeneralMeanActive){showGeneralMean();}
			if(GroupMeanActive){showGroupMean();}
			myChart.destroy();
			myChart = new Chart(ctx,{
				type: 'radar',
				data: RadarDataSet,
				options: optionsRadarChart
			});
			myChart.data.datasets.forEach((dataset) => {
				color = colorRGB(dataset.label);
				dataset.backgroundColor = color + '0.3)';
				dataset.borderColor = color + '1)';
				dataset.pointBackgroundColor = color + '1)';
				dataset.pointBorderColor = color + '1)';
				dataset.fill = true;
			});
			break;
	}

	myChart.update();
}

// Funcion que recibe el tipo de grafico y su data set y lo actualiza
function updateChart(type, dataSet){
	if(currentType != 'table') {
		switch (type) {
			case 'line':
				LineDataSet = dataSet;
				if(currentType == 'line'){				
					myChart.data = LineDataSet;
					myChart.data.datasets.forEach((dataset) => {
						color = colorRGB(dataset.label);
						dataset.backgroundColor = color + '1)';
						dataset.borderColor = color + '1)';
						dataset.pointBackgroundColor = color + '1)';
						dataset.pointBorderColor = color + '1)';
						dataset.fill = false;
					});
					if (GeneralMeanActive) {myChart.data.datasets.push(GeneralMeanDataSet);}
					if (GroupMeanActive) {myChart.data.datasets.push(GroupMeanDataSet);}
				}
				break;
			case 'boxplot':
				BoxPlotGeneralDataSet = dataSet;
				if(currentType == 'boxplot'){
					myChart.data = BoxPlotGeneralDataSet;	
				}
				break;
			case 'boxplotgroup':
				BoxPlotGroupDataSet = dataSet;
				if(currentType == 'boxplotgroup'){
					myChart.data = BoxPlotGroupDataSet;	
				}
				break;
			case 'radar':
				RadarDataSet = dataSet;
				if(currentType == 'radar'){
					myChart.data = RadarDataSet;
					myChart.data.datasets.forEach((dataset) => {
						color = colorRGB(dataset.label);
						dataset.backgroundColor = color + '0.3)';
						dataset.borderColor = color + '1)';
						dataset.pointBackgroundColor = color + '1)';
						dataset.pointBorderColor = color + '1)';
						dataset.fill = true;
					});
					if (GeneralMeanActive) {myChart.data.datasets.push(GeneralMeanDataSet);}
					if (GroupMeanActive) {myChart.data.datasets.push(GroupMeanDataSet);}
				}
				break;
		}
		myChart.update();
		document.getElementById('chart-container').style.display = 'block';
		document.getElementById('inicio').style.display = 'none';
	}
}

//Funcion que almacena la media general.
function saveMean(mean) {
	GeneralMeanDataSet = mean;
}

//Funcion que almacena la media del grupo.
function saveGroupMean(mean){
	GroupMeanDataSet = mean;
}

//Funcion que almacena la media del grupo.
function saveTableData(dataSet){
	TableDataSet = dataSet;
	if(currentType == 'table'){
		drawTable();
	}
}


//Funcion que muestra u oculta la media general del gráfico
function showGeneralMean() {
	if('' != GeneralMeanDataSet && GeneralMeanActive == false){
		GeneralMeanActive = true;
		myChart.data.datasets.push(GeneralMeanDataSet);
		myChart.update();
		document.getElementById('btnMean').value = 'Ocultar Media General';
	} else if(GeneralMeanActive == true){
		GeneralMeanActive = false;
		removeDataSet('Media general');
		document.getElementById('btnMean').value = 'Mostrar Media General';
	}
}

//Funcion que muestra u oculta la media del grupo del gráfico
function showGroupMean() {
	if('' != GroupMeanDataSet && GroupMeanActive == false){
		GroupMeanActive = true;
		myChart.data.datasets.push(GroupMeanDataSet);
		myChart.update();
		document.getElementById('btnGroupMean').value = 'Ocultar Media Del Grupo';
	} else if(GroupMeanActive == true){
		GroupMeanActive = false;
		removeDataSet('Media del grupo');
		document.getElementById('btnGroupMean').value = 'Mostrar Media Del Grupo';
	}
}

//Elimina el DataSet del gráfico que conincida con la label pasada
function removeDataSet(DataSetLabel) {
	var arrayLength = myChart.data.datasets.length;
	
	for(var i = 0; i < arrayLength; i++) {
		if(myChart.data.datasets[i].label == DataSetLabel){
			myChart.data.datasets.splice(i,1);
			myChart.update();
			i = arrayLength;
		}
	}
}

//Funcion que muestra u oculta la leyenda del gráfico
function hideLegend(){
	if(legendActive == true){
		legendActive = false;
		myChart.options.legend.display = false;
		myChart.update();
		document.getElementById('btnLegend').value = 'Mostrar Leyenda';
	} else {
		legendActive = true;
		myChart.options.legend.display = true;
		myChart.update();
		document.getElementById('btnLegend').value = 'Ocultar Leyenda';
	}
}

//Funcion que devuelve un color en formato 'rgba(r,g,b', a falta de la transpaerncia
//en base a el string que se le pasa
function colorRGB(color){
	var rgbaColor = 'rgba(';
	var colors = []
	colors = colorHash.rgb(color);
	for (i = 0; i < colors.length; i++) {
		rgbaColor += colors[i] + ',';
	}
	return rgbaColor;
}

//Funcion que devuelve un color en formato hexadecimal
//en base a el string que se le pasa
function colorHEX(color){
	return colorHash.hex(color);
}

</script>

</body>
</html>